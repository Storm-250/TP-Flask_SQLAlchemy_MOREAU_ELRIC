from flask import Blueprint, render_template, redirect, url_for,jsonify, request

from .model import  Reservation, Chambre
from .database import db
main = Blueprint('main', __name__)

@main.route('/api/chambres/disponibles', methods=['GET'])
def disponibles(date_arrive,date_depart,id):
    date = request.json['date'],
    for i in range(len(Chambre.query.all())):
        id=i
        Chambre.query.get_or_404(id)
        date_a=date_arrive
        date_d=date_depart

        if date_a>date & date_d<date :
            return({Chambre})
            
    return jsonify({'message':'Chambres disponibles'})


@main.route('/api/reservation', methods=['POST'])
def reservation(date_arrive,date_depart):
    reservation = Reservation.query.all()
    return jsonify({'message':'reservation faite'})

@main.route('/api/reservations/<int:id>', methods=['DELETE'])
def reservation_annulation(id):
   Reservation.query.get_or_404(id)
   sup=request.json['SUPPRIMER O/N ?']
   if sup=='O':
        db.session.DELETE()
        db.session.commit()
        return jsonify({'reservation SUPPRIME'})
   return jsonify({'ERROR'})
   




@main.route('/api/chambre', methods=['POST'])
def ajouter_chambre():
        numero=request.json['numero']
        type=request.json['type']
        prix=request.json['prix']

        new_chambre = Chambre(
            numero = numero,
            type = type,
            prix = prix
        )
        db.session.add(new_chambre)
        db.session.commit()
        return jsonify({'Nouvelle chambre'})



@main.route('/api/chambre/<int:id>', methods=['DELETE'])
def chambre_annulation(id):
   Chambre.query.get_or_404(id)
   if type!='DELETE':
        type=request.json['type']
        Chambre.type = type,
        db.session.commit()
        return jsonify({'Chambre SUPPRIME'})
   else:
       return jsonify({'Chambre déjà SUPPRIME'})


@main.route('/api/chambre/<int:id>', methods=['PUT'])
def changer_chambre(id):
   Chambre.query.get_or_404(id)
   if type!='DELETE':
        numero=request.json['numero']
        type=request.json['type']
        prix=request.json['prix']
        Chambre.numero = numero,
        Chambre.type = type,
        Chambre.prix = prix
        db.session.commit()
        return jsonify({'Chambre modifié'})
   else:
       return jsonify({'Chambre SUPPRIME'})
